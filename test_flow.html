<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Whisperz Flow Test</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #0a0a0f;
            color: #fff;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            transform: scale(1.05);
        }
        .result {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #667eea;
            border-radius: 8px;
        }
        h1 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body>
    <h1>üöÄ Whisperz Complete Flow Test</h1>
    
    <div class="test-section">
        <h2>1. App Preview</h2>
        <iframe id="appFrame" src="http://localhost:5173"></iframe>
    </div>
    
    <div class="test-section">
        <h2>2. Test Controls</h2>
        <button onclick="enableDevTools()">Enable DevTools</button>
        <button onclick="simulateLogin()">Simulate Login</button>
        <button onclick="checkComponents()">Check Components</button>
        <button onclick="testKonamiCode()">Test Konami Code</button>
        <button onclick="clearAll()">Clear All Data</button>
        <div id="controlResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Component Status</h2>
        <div id="componentStatus" class="result">Click "Check Components" to analyze...</div>
    </div>

    <script>
        const frame = document.getElementById('appFrame');
        const resultDiv = document.getElementById('controlResult');
        const statusDiv = document.getElementById('componentStatus');
        
        function log(message) {
            resultDiv.textContent = message + '\n' + resultDiv.textContent;
        }
        
        function enableDevTools() {
            try {
                frame.contentWindow.localStorage.setItem('enableDevTools', 'true');
                log('‚úÖ DevTools enabled in localStorage');
                frame.contentWindow.location.reload();
            } catch(e) {
                log('‚ùå Error: ' + e.message);
            }
        }
        
        function simulateLogin() {
            log('üìù To login: Use the login form in the iframe above');
            log('   - Create a test account first if needed');
            log('   - Username: testuser');
            log('   - Password: testpass123');
        }
        
        function checkComponents() {
            try {
                const doc = frame.contentDocument;
                let status = '=== Component Analysis ===\n\n';
                
                // Check for login view
                const authContainer = doc.querySelector('.auth-container');
                status += authContainer ? '‚úÖ Login View: VISIBLE\n' : '‚ùå Login View: NOT FOUND\n';
                
                // Check for chat view
                const chatContainer = doc.querySelector('.chat-container');
                status += chatContainer ? '‚úÖ Chat View: VISIBLE (User logged in)\n' : '‚ùå Chat View: NOT FOUND\n';
                
                // Check for logout button
                const logoutBtn = doc.querySelector('.logout-btn');
                status += logoutBtn ? '‚úÖ Logout Button: FOUND\n' : '‚ùå Logout Button: NOT FOUND\n';
                
                // Check for DevTools
                const devTools = doc.querySelector('[class*="devtools"]');
                status += devTools ? '‚úÖ DevTools: VISIBLE\n' : '‚ùå DevTools: NOT VISIBLE\n';
                
                // Check for ThemeToggle
                const themeToggle = doc.querySelector('.theme-toggle-container');
                status += themeToggle ? '‚úÖ Theme Toggle: VISIBLE\n' : '‚ùå Theme Toggle: NOT FOUND\n';
                
                // Check for ConnectionStatus
                const connStatus = Array.from(doc.querySelectorAll('div')).find(el => 
                    el.textContent.includes('Gun.js:') || el.textContent.includes('WebRTC:')
                );
                status += connStatus ? '‚úÖ Connection Status: VISIBLE\n' : '‚ùå Connection Status: NOT FOUND\n';
                
                // Check localStorage
                const gunData = frame.contentWindow.localStorage.getItem('gun/');
                status += gunData ? '‚úÖ Gun Data: PRESENT\n' : '‚ùå Gun Data: NOT FOUND\n';
                
                const devToolsEnabled = frame.contentWindow.localStorage.getItem('enableDevTools');
                status += devToolsEnabled ? '‚úÖ DevTools Enabled: ' + devToolsEnabled + '\n' : '‚ùå DevTools: NOT ENABLED\n';
                
                statusDiv.textContent = status;
                log('‚úÖ Component check complete');
            } catch(e) {
                log('‚ùå Error checking components: ' + e.message);
                statusDiv.textContent = 'Error: Cannot access iframe (CORS). Open the app directly at http://localhost:5173';
            }
        }
        
        function testKonamiCode() {
            log('üéÆ Enter Konami Code in the app: ‚Üë ‚Üë ‚Üì ‚Üì ‚Üê ‚Üí ‚Üê ‚Üí B A');
            log('   This will enable DevTools in production');
        }
        
        function clearAll() {
            try {
                frame.contentWindow.localStorage.clear();
                frame.contentWindow.sessionStorage.clear();
                log('‚úÖ All storage cleared');
                frame.contentWindow.location.reload();
            } catch(e) {
                log('‚ùå Error: ' + e.message);
            }
        }
        
        // Initial check after page loads
        setTimeout(() => {
            log('üîç Page loaded. Click "Check Components" to analyze the app state.');
        }, 2000);
    </script>
</body>
</html>